name: Build & Optimize Assets

on:
  push:
    branches:
      - main
    paths:
      - 'app/static/**'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Install WebP Tools
        run: sudo apt-get update && sudo apt-get install -y webp

      - name: Run Optimization Script
        run: ./.github/workflows/scripts/build_assets.sh

      - name: Commit Optimized Assets
        uses: stefanzweifel/git-auto-commit-action@v4
        with:
          commit_message: "CHORE: Auto-optimize images to WebP and minify assets"
          file_pattern: "app/static/**"
